<!doctype html><html lang=pt-br>
<head>
<meta itemprop=name content="Um ambiente simples usando Kubernetes e OpenShift Next Gen - Parte 1">
<meta property="og:title" content="Um ambiente simples usando Kubernetes e OpenShift Next Gen - Parte 1">
<meta itemprop=description content="Como parte das minhas metas dentro da Coderockr está a construção de um cluster usando algumas das ferramentas de orquestração de contêineres que existem no mercado; como o Docker Swarm, Kubernetes, Apache Mesos, etc. Optei pelo Kubernetes...">
<meta property="og:description" content="Como parte das minhas metas dentro da Coderockr está a construção de um cluster usando algumas das ferramentas de orquestração de contêineres que existem no mercado; como o Docker Swarm, Kubernetes, Apache Mesos, etc. Optei pelo Kubernetes...">
<meta property="og:url" content="https://www.lucassabreu.net.br/post/um-ambiente-simples-usando-kubernetes-e-openshift-next-gen-parte-1/">
<meta property="og:site_name" content="Lucas dos Santos Abreu">
<meta property="og:type" content="article">
<meta property="og:locale" content="pt-BR"><meta itemprop=datePublished content="2017-03-07T00:00:00+00:00">
<meta itemprop=dateModified content="2017-03-07T00:00:00+00:00">
<meta itemprop=wordCount content="770">
<meta itemprop=image content="https://www.lucassabreu.net.br/post/um-ambiente-simples-usando-kubernetes-e-openshift-next-gen-parte-1/header.png">
<meta property="og:image" content="https://www.lucassabreu.net.br/white_hu8334ad00c26f930f76e93dcf8b9ae200_1453_c521e4b8037ac338a1cd9bc0c9d38757.png">
<meta name=twitter:card content="summary_large_image"><meta property="author" content="Lucas dos Santos Abreu"><meta name=twitter:creator content="@LucasSantAbreu">
<meta name=twitter:site content="@LucasSantAbreu">
<meta itemprop=keywords content="Kubernetes,Openshift,Introduction,Simple,Docker,">
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta http-equiv=x-ua-compatible content="IE=edge">
<style type=text/css>body{font-family:monospace}</style>
<title>
Um ambiente simples usando Kubernetes e OpenShift Next Gen - Parte 1 |
Lucas dos Santos Abreu
</title>
<link rel=stylesheet href="/css/style.css?rnd=1635331326">
<script src="/js/index.js?rnd=1635331326"></script>
</head>
<body>
<a class=skip-to-content-link href=#main> Skip to content </a>
<header class=page-header>
<nav arial-label=primary role=menu>
<a href=/>Home</a>
<a href=/resume>Resume</a>
<a href=https://twitter.com/LucasSantAbreu>Twitter</a>
<a href=https://github.com/lucassabreu>GitHub</a>
<a href=https://medium.com/@lucassabreu>Medium</a>
<a href=https://www.linkedin.com/in/lucassantosabreu>LinkedIn</a>
</nav>
</header>
<main id=main>
<article>
<header>
<h1>Um ambiente simples usando Kubernetes e OpenShift Next Gen - Parte 1</h1>
<p>
<span class=reading-time>4 minute read</span>
<span class=published-at>
Published:
<time datetime="2017-03-07 00:00:00 +0000 UTC">2017-03-07</time>
</span>
</p>
</header>
<div class=content role=content>
<figure class=big>
<img class="lazyload blur-up" loading=lazy data-src=/post/um-ambiente-simples-usando-kubernetes-e-openshift-next-gen-parte-1/header.png width=1000 height=165>
</figure>
<p>Como parte das minhas metas dentro da <a href=http://blog.coderockr.com>Coderockr</a> está a construção de um cluster usando algumas das ferramentas de orquestração de contêineres que existem no mercado; como o <a href=https://docs.docker.com/engine/swarm/>Docker Swarm</a>, <a href=http://kubernetes.io>Kubernetes</a>, <a href=http://mesos.apache.org/>Apache Mesos</a>, etc.</p>
<p>Optei pelo <strong>Kubernetes</strong> no momento, tanto pelo pedigree, criado pelo Google e mantido pela Cloud Native Computing Foundation; quanto pela oferta de grandes clouds como a Red Hat, Azure e Google.</p>
<p>Quando estava avaliando as opções disponíveis, o <a href=https://medium.com/@JeanCarloMachad>Jean Carlo Machado</a> (colega da <a href=https://medium.com/@compufacil>CompuFácil</a>), me sugeriu usar o <a href=https://blog.openshift.com/next-generation-openshift-online/><strong>OpenShift Next Gen</strong></a>, a plataforma da Red Hat para Kubernetes, que esta em <a href=https://www.openshift.com/devpreview/>Developer Preview</a> permitindo que você se cadastre para testar a ferramenta deles por 30 dias.</p>
<p>Isso me salvou de já ter de sair pagando para testar, ou ter de fazer o <a href=https://kubernetes.io/docs/getting-started-guides/minikube/>setup do minikube</a> na minha máquina, o que não me era muito atrativo.</p>
<p>Assim resolvi dar uma chance a plataforma da Red Hat, e construir um ambiente simples com um servidor HTTP em Node e um banco de dados MySQL, o que já me permite cobrir vários aspectos básicos do Kubernetes.</p>
<p>Mas como o texto foi ficando muito grande, achei melhor quebrá-lo em 4 partes para não cansar quem for ler e que irei publicar nos próximos dias.</p>
<p>Nessa primeira parte vou dar uma introdução aos conceitos básicos do Kubernetes, e nas próximas irei fazer uso desses conceitos.</p>
<ul>
<li>Parte 2 - Construindo o Ambiente: <a href=/post/um-ambiente-simples-usando-kubernetes-e-openshift-next-gen-parte-2/>clique aqui</a></li>
<li>Parte 3 - Volumes Persistentes: <a href=/post/um-ambiente-simples-usando-kubernetes-e-openshift-next-gen-parte-3/>clique aqui</a></li>
<li>Parte 4 - Segredos: <a href=/post/um-ambiente-simples-usando-kubernetes-e-openshift-next-gen-parte-4/>clique aqui</a></li>
</ul>
<hr>
<p>A aplicação que construí usa um <a href=https://www.kaggle.com/joniarroba/noshowappointments>conjunto de dados sobre faltas em consultas</a> que achei no <a href=https://www.kaggle.com/>Kaggle</a> e gera os gráficos abaixo, podendo escolher o dia da semana como filtro.</p>
<figure>
<img class="lazyload blur-up" loading=lazy data-src=/post/um-ambiente-simples-usando-kubernetes-e-openshift-next-gen-parte-1/app-view.png width=800 height=541>
<figcaption><p>O fonte dessa aplicação pode ser encontrado aqui: &lt;https://github.com/lucassabreu/openshift-next-gen/tree/app></p></figcaption>
</figure>
<p>Então publiquei no <a href=http://hub.docker.com>Docker Hub</a> uma imagem para a aplicação (<a href=https://hub.docker.com/r/lucassabreu/openshift-app-test/>lucassabreu/openshift-app-test</a>) e outra para o banco de dados (<a href=https://hub.docker.com/r/lucassabreu/openshift-mysql-test/>lucassabreu/openshift-mysql-test</a>) - essa imagem é um MySQL normal, mas que adicionei um dump da base que vou usar para facilitar o deploy.</p>
<p>Agora se eu quiser executar essa aplicação na minha máquina, posso simplesmente executar os seguintes comando do Docker e terei o servidor me respondendo em <code>http://localhost</code>:</p>
<div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#719e07>#!/bin/bash
</span><span style=color:#719e07></span>docker run -d --name db-test <span style=color:#cb4b16>\
</span><span style=color:#cb4b16></span>  -e <span style=color:#268bd2>MYSQL_ROOT_PASSWORD</span><span style=color:#719e07>=</span>root -e <span style=color:#268bd2>MYSQL_DATABASE</span><span style=color:#719e07>=</span>appointments <span style=color:#cb4b16>\
</span><span style=color:#cb4b16></span>  -e <span style=color:#268bd2>MYSQL_USER</span><span style=color:#719e07>=</span>appoint -e <span style=color:#268bd2>MYSQL_PASSWORD</span><span style=color:#719e07>=</span><span style=color:#2aa198>123</span> <span style=color:#cb4b16>\
</span><span style=color:#cb4b16></span>  lucassabreu/openshift-mysql-test

docker run -d --name app-test --link db-test:db <span style=color:#cb4b16>\
</span><span style=color:#cb4b16></span>  -e <span style=color:#268bd2>DATABASE_CONNECTION</span><span style=color:#719e07>=</span>mysql://appoint:123@<span style=color:#268bd2>$db</span>:3306/appointments <span style=color:#cb4b16>\
</span><span style=color:#cb4b16></span>  -p 80:8080 lucassabreu/openshift-app-test
</code></pre></div><p>Certo, agora que tenho certeza de que a minha aplicação está operacional, comecei a criar os objetos do Kubernetes, mas antes é importante entender alguns conceitos da plataforma para não ficar muito perdido:</p>
<h4 id=podhttpskubernetesiodocsuser-guidepods>
<a href=https://kubernetes.io/docs/user-guide/pods/>Pod</a>
<a href=#podhttpskubernetesiodocsuser-guidepods class=heading-anchor aria-label="copy link to this section" title="Copy link to this section"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" xmlns:xlink="http://www.w3.org/1999/xlink" enable-background="new 0 0 512 512"><g><g><g><path d="M480.7 11H130.4c-11.3.0-20.4 9.1-20.4 20.4v60.3H31.5c-11.3.0-20.4 9.1-20.4 20.4v368.5c0 11.3 9.1 20.4 20.4 20.4h350.3c11.3.0 20.4-9.1 20.4-20.4v-60.3h78.5c11.3.0 20.4-9.1 20.4-20.4V31.4C501.1 20.1 491.9 11 480.7 11zM361.3 460.2H51.9V132.5h309.4V460.2zm98.9-80.7h-58.1V112.1c0-11.3-9.1-20.4-20.4-20.4h-231V51.8h309.4V379.5z"/><path d="m127.8 242.6h157.7c11.3.0 20.4-9.1 20.4-20.4s-9.1-20.4-20.4-20.4H127.8c-11.3.0-20.4 9.1-20.4 20.4s9.1 20.4 20.4 20.4z"/><path d="m127.8 390.9h157.7c11.3.0 20.4-9.1 20.4-20.4.0-11.3-9.1-20.4-20.4-20.4H127.8c-11.3.0-20.4 9.1-20.4 20.4.0 11.2 9.1 20.4 20.4 20.4z"/></g></g></g></svg>
</a>
</h4>
<p>Este é o menor componente do Kubernetes, representa um nó no cluster, executando um ou mais contêineres que entregam uma mesma função.</p>
<p>Eles tem a característica de serem descartáveis, ou seja, se eventualmente acontecer algum problema a um Pod, este pode ser destruído sem nenhum efeito colateral ou remorso.</p>
<h4 id=deploymenthttpskubernetesiodocsuser-guidedeployments>
<a href=https://kubernetes.io/docs/user-guide/deployments/>Deployment</a>
<a href=#deploymenthttpskubernetesiodocsuser-guidedeployments class=heading-anchor aria-label="copy link to this section" title="Copy link to this section"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" xmlns:xlink="http://www.w3.org/1999/xlink" enable-background="new 0 0 512 512"><g><g><g><path d="M480.7 11H130.4c-11.3.0-20.4 9.1-20.4 20.4v60.3H31.5c-11.3.0-20.4 9.1-20.4 20.4v368.5c0 11.3 9.1 20.4 20.4 20.4h350.3c11.3.0 20.4-9.1 20.4-20.4v-60.3h78.5c11.3.0 20.4-9.1 20.4-20.4V31.4C501.1 20.1 491.9 11 480.7 11zM361.3 460.2H51.9V132.5h309.4V460.2zm98.9-80.7h-58.1V112.1c0-11.3-9.1-20.4-20.4-20.4h-231V51.8h309.4V379.5z"/><path d="m127.8 242.6h157.7c11.3.0 20.4-9.1 20.4-20.4s-9.1-20.4-20.4-20.4H127.8c-11.3.0-20.4 9.1-20.4 20.4s9.1 20.4 20.4 20.4z"/><path d="m127.8 390.9h157.7c11.3.0 20.4-9.1 20.4-20.4.0-11.3-9.1-20.4-20.4-20.4H127.8c-11.3.0-20.4 9.1-20.4 20.4.0 11.2 9.1 20.4 20.4 20.4z"/></g></g></g></svg>
</a>
</h4>
<p>Como o nome sugere controla o deploy de Pods dentro do cluster. Quando se cria esse componente, deve-se informar um template de Pod e quantos destes você precisa, e se necessário uma regra para criar mais instâncias.</p>
<p>Ele irá garantir duas coisas principalmente: que existam suficientes Pods quanto foi definido, e que os mesmos estejam atualizados em relação ao template que foi definido.</p>
<p>Então caso você mude algo no template o Deployment vai subir novos Pods e destruir os antigos para manter a expectativa (ele também &ldquo;versiona&rdquo; os deploys, então se algo explodir dá para voltar atrás).</p>
<h4 id=servicehttpskubernetesiodocsuser-guideservices>
<a href=https://kubernetes.io/docs/user-guide/services/>Service</a>
<a href=#servicehttpskubernetesiodocsuser-guideservices class=heading-anchor aria-label="copy link to this section" title="Copy link to this section"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" xmlns:xlink="http://www.w3.org/1999/xlink" enable-background="new 0 0 512 512"><g><g><g><path d="M480.7 11H130.4c-11.3.0-20.4 9.1-20.4 20.4v60.3H31.5c-11.3.0-20.4 9.1-20.4 20.4v368.5c0 11.3 9.1 20.4 20.4 20.4h350.3c11.3.0 20.4-9.1 20.4-20.4v-60.3h78.5c11.3.0 20.4-9.1 20.4-20.4V31.4C501.1 20.1 491.9 11 480.7 11zM361.3 460.2H51.9V132.5h309.4V460.2zm98.9-80.7h-58.1V112.1c0-11.3-9.1-20.4-20.4-20.4h-231V51.8h309.4V379.5z"/><path d="m127.8 242.6h157.7c11.3.0 20.4-9.1 20.4-20.4s-9.1-20.4-20.4-20.4H127.8c-11.3.0-20.4 9.1-20.4 20.4s9.1 20.4 20.4 20.4z"/><path d="m127.8 390.9h157.7c11.3.0 20.4-9.1 20.4-20.4.0-11.3-9.1-20.4-20.4-20.4H127.8c-11.3.0-20.4 9.1-20.4 20.4.0 11.2 9.1 20.4 20.4 20.4z"/></g></g></g></svg>
</a>
</h4>
<p>Como os Pods além de efêmeros, podem existir em números variados por culpa dos Deployments, não há forma confiável de tentar conectar dois Pods diretamente, seja porque o Pod que você está dependendo pode morrer e quando voltar terá outro IP, e provavelmente outro nome, ou porque o Pod que você &ldquo;fixou&rdquo; pode não ser o mas indicado (menos ocupado ou mais próximo).</p>
<p>Para resolver esse problema existem os Services, em vez de tentar fazer as chamadas diretamente para um Pod, podemos chamar pelo nome de um Service e este irá rotear para um Pod que esteja abaixo dele.</p>
<p>É importante ressaltar que os Services fazem &ldquo;apenas&rdquo; a descoberta dos Pods, eles não os mantêm ligados, isso é responsabilidade dos Deployments.</p>
<h4 id=routehttpsdocsopenshiftorglatestarchitecturecore_conceptsrouteshtml>
<a href=https://docs.openshift.org/latest/architecture/core_concepts/routes.html>Route</a>
<a href=#routehttpsdocsopenshiftorglatestarchitecturecore_conceptsrouteshtml class=heading-anchor aria-label="copy link to this section" title="Copy link to this section"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" xmlns:xlink="http://www.w3.org/1999/xlink" enable-background="new 0 0 512 512"><g><g><g><path d="M480.7 11H130.4c-11.3.0-20.4 9.1-20.4 20.4v60.3H31.5c-11.3.0-20.4 9.1-20.4 20.4v368.5c0 11.3 9.1 20.4 20.4 20.4h350.3c11.3.0 20.4-9.1 20.4-20.4v-60.3h78.5c11.3.0 20.4-9.1 20.4-20.4V31.4C501.1 20.1 491.9 11 480.7 11zM361.3 460.2H51.9V132.5h309.4V460.2zm98.9-80.7h-58.1V112.1c0-11.3-9.1-20.4-20.4-20.4h-231V51.8h309.4V379.5z"/><path d="m127.8 242.6h157.7c11.3.0 20.4-9.1 20.4-20.4s-9.1-20.4-20.4-20.4H127.8c-11.3.0-20.4 9.1-20.4 20.4s9.1 20.4 20.4 20.4z"/><path d="m127.8 390.9h157.7c11.3.0 20.4-9.1 20.4-20.4.0-11.3-9.1-20.4-20.4-20.4H127.8c-11.3.0-20.4 9.1-20.4 20.4.0 11.2 9.1 20.4 20.4 20.4z"/></g></g></g></svg>
</a>
</h4>
<p>Permitem que você exponha Services para a rede externa e também permite algumas regras de proxy para melhor apresentá-los.</p>
<p>Embora seja possível fazer a exposição de Services para a rede externa com Kubernetes, na plataforma da OpenShift é necessário o uso do componente Route para isso.</p>
<hr>
<p>Como comentei no início, estou escrevendo uma série de postagens para mostrar como usar o básico do Kubernetes, e no próximo post irei usar os conceitos que acabei de descrever para implementar o ambiente.</p>
<p>Próximo Post: <a href=/post/um-ambiente-simples-usando-kubernetes-e-openshift-next-gen-parte-2/>clique aqui</a></p>
</div><section class=share>
<p>
Share this post at
<a href="https://twitter.com/share?text=Um%20ambiente%20simples%20usando%20Kubernetes%20e%20OpenShift%20Next%20Gen%e2%80%8a-%e2%80%8aParte%c2%a01&nbsp;-&nbsp;Lucas%20dos%20Santos%20Abreu&url=https%3a%2f%2fwww.lucassabreu.net.br%2fpost%2fum-ambiente-simples-usando-kubernetes-e-openshift-next-gen-parte-1%2f" onclick="return window.open(this.href,'twitter-share','width=550,height=235'),!1">
Twitter
</a>
<a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.lucassabreu.net.br%2fpost%2fum-ambiente-simples-usando-kubernetes-e-openshift-next-gen-parte-1%2f" onclick="return window.open(this.href,'facebook-share','width=580,height=296'),!1">
Facebook
</a>
<a href="http://pinterest.com/pin/create/button/?url=https%3a%2f%2fwww.lucassabreu.net.br%2fpost%2fum-ambiente-simples-usando-kubernetes-e-openshift-next-gen-parte-1%2f&description=Um%20ambiente%20simples%20usando%20Kubernetes%20e%20OpenShift%20Next%20Gen%e2%80%8a-%e2%80%8aParte%c2%a01" onclick="return window.open(this.href,'pinterest-share','width=580,height=296'),!1">
Pinterest
</a>
<a href="http://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fwww.lucassabreu.net.br%2fpost%2fum-ambiente-simples-usando-kubernetes-e-openshift-next-gen-parte-1%2f&title=Um%20ambiente%20simples%20usando%20Kubernetes%20e%20OpenShift%20Next%20Gen%e2%80%8a-%e2%80%8aParte%c2%a01%20-%20Lucas%20dos%20Santos%20Abreu" onclick="return window.open(this.href,'linkedin-share','width=680,height=540'),!1">
Linkedin
</a>
</p>
</section>
<footer>
<section role=comment>
<p>
<div id=disqus_thread></div>
<script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//lucas-dos-santos-abreu.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script>
<noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript>
<a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a>
</p>
</section>
<section>
<p>
Published
by <span itemprop=author></span>
<time datetime=2017-03-07T00:00:00+00:00>
7 Mar, 2017
</time>
and tagged
<a href=/tags/kubernetes>Kubernetes</a>
<a href=/tags/openshift>Openshift</a>
<a href=/tags/introduction>Introduction</a>
<a href=/tags/simple>Simple</a>
<a href=/tags/docker>Docker</a>
using <span itemprop=wordCount>770</span> words.
</p>
</section>
</footer>
</article>
</main>
<aside>
<header>Related Content</header>
<ul>
<li>
<a href=/post/ambientes-por-branch-com-openshift-next-gen-usando-github/>Ambientes por Branch com OpenShift Next Gen usando GitHub</a> &ndash;
<time>9 minute read</time>
</li>
<li>
<a href=/post/ambientes-por-branch-com-openshift-next-gen/>Ambientes por Branch com OpenShift Next Gen</a> &ndash;
<time>9 minute read</time>
</li>
<li>
<a href=/gist/coderockr-jam-2017-03/>Notas Kubernetes - Coderockr Jam 2017-03-11</a> &ndash;
<time>5 minute read</time>
</li>
<li>
<a href=/post/um-ambiente-simples-usando-kubernetes-e-openshift-next-gen-parte-4/>Um ambiente simples usando Kubernetes e OpenShift Next Gen - Parte 4</a> &ndash;
<time>4 minute read</time>
</li>
<li>
<a href=/post/um-ambiente-simples-usando-kubernetes-e-openshift-next-gen-parte-3/>Um ambiente simples usando Kubernetes e OpenShift Next Gen - Parte 3</a> &ndash;
<time>4 minute read</time>
</li>
<li>
<a href=/post/um-ambiente-simples-usando-kubernetes-e-openshift-next-gen-parte-2/>Um ambiente simples usando Kubernetes e OpenShift Next Gen - Parte 2</a> &ndash;
<time>5 minute read</time>
</li>
</ul>
</aside>
<a href=#main id=back-to-top>Back to the top</a>
<footer>
<p>
&copy;
2021 ·
This page was generated using <a target=_blank rel=noopener href=https://github.com/lucassabreu/smol>smol<a> for <a target=_blank rel=noopener href=https://gohugo.io/>Hugo</a>.
</p>
</footer>
</body>
</html>