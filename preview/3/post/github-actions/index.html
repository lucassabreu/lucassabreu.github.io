<!doctype html><html lang=pt-br>
<head>
<meta itemprop=name content="Github Actions">
<meta itemprop=description content="O que √© isso? O Github Actions √© primariamente uma ferramenta para implementar Continuous Integration, ou seja, automatizar a execu√ß√£o de ferramentas ou processos que ajudam a garantir a qualidade do c√≥digo, seja teste unit√°rios, an√°lises de c√≥digo est√°tica, analises de seguran√ßa, simplesmente compilar/&ldquo;buildar&rdquo; o projeto.
Al√©m disso tamb√©m podemos implementar fluxos de Continuous Delivery, fazendo o deploy ou bundle do projeto de forma autom√°tica sempre que um evento acontece, seja o push para uma branch, ou algum outro evento do Github."><meta itemprop=datePublished content="2021-09-12T00:00:00+00:00">
<meta itemprop=dateModified content="2021-09-12T00:00:00+00:00">
<meta itemprop=wordCount content="600">
<meta itemprop=keywords content="Github,Github Actions,Continuous Integration,">
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta http-equiv=x-ua-compatible content="IE=edge">
<style type=text/css>body{font-family:monospace}</style>
<title>
Github Actions |
Lucas dos Santos Abreu
</title>
<link rel=stylesheet href="/css/style.css?rnd=1632057135">
<script src=https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.3.2/lazysizes.min.js integrity="sha512-q583ppKrCRc7N5O0n2nzUiJ+suUv7Et1JGels4bXOaMFQcamPk9HjdUknZuuFjBNs7tsMuadge5k9RzdmO+1GQ==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=/js/index.js></script>
</head>
<body>
<a class=skip-to-content-link href=#main> Skip to content </a>
<header class=page-header>
<nav arial-label=primary role=menu>
<a href=/>Home</a>
<a href=/resume>Resume</a>
<a href=https://twitter.com/LucasSantAbreu>Twitter</a>
<a href=https://github.com/lucassabreu>GitHub</a>
<a href=https://medium.com/@lucassabreu>Medium</a>
<a href=https://www.linkedin.com/in/lucassantosabreu>LinkedIn</a>
</nav>
</header>
<main id=main>
<article>
<header>
<h1>Github Actions</h1>
<p>
<span class=reading-time>3 minute read</span>
<span class=published-at>
Published:
<time datetime="2021-09-12 00:00:00 +0000 UTC">2021-09-12</time>
</span>
</p>
</header>
<nav role=navigation class=toc><strong>TOC</strong>
<ol>
<li><a href=#o-que-√©-isso>O que √© isso?</a></li>
<li><a href=#como-temos-usado-o-github-actionsci-em-geral>Como temos usado o Github Actions/CI em geral</a></li>
<li><a href=#show-me-the-code>Show me the code</a>
<ol>
<li><a href=#workflow-simples>Workflow simples</a>
<ol>
<li><a href=#lintsanalise-est√°tica-com-annotations>Lints/Analise Est√°tica com annotations</a></li>
</ol>
</li>
</ol>
</li>
</ol>
<ol>
<li><a href=#o-que-√©-o-github-actions>o que √© o github actions</a></li>
<li><a href=#no-que-temos-usado-o-github-actionsci>no que temos usado o github actions/ci</a></li>
<li><a href=#exemplos-para-pull-requestpush>exemplos para pull request/push</a>
<ol>
<li><a href=#shbash-annotations-usando-output-format>sh/bash, annotations usando output format</a></li>
<li><a href=#usar-typescript-com-actions-kit>usar typescript com actions kit</a></li>
<li><a href=#usar-imagens-do-dockerdockerfile-action>usar imagens do docker/dockerfile action</a></li>
</ol>
</li>
<li><a href=#eventos-interessantes>eventos interessantes</a>
<ol>
<li><a href=#cron-wakatime-profile>cron: wakatime profile</a></li>
<li><a href=#issue-comment>issue comment</a></li>
<li><a href=#workflow_dispatch-gh-workflow-run>workflow_dispatch: gh workflow run</a></li>
</ol>
</li>
<li><a href=#usar-os-runners-em-infra-pr√≥pria>usar os runners em infra pr√≥pria</a></li>
</ol>
</nav>
<div class=content role=content>
<h2 id=o-que-√©-isso>O que √© isso?</h2>
<p>O Github Actions √© primariamente uma ferramenta para implementar Continuous
Integration, ou seja, automatizar a execu√ß√£o de ferramentas ou processos que
ajudam a garantir a qualidade do c√≥digo, seja teste unit√°rios, an√°lises de
c√≥digo est√°tica, analises de seguran√ßa, simplesmente compilar/&ldquo;buildar&rdquo; o
projeto.</p>
<p>Al√©m disso tamb√©m podemos implementar fluxos de Continuous Delivery, fazendo o
deploy ou bundle do projeto de forma autom√°tica sempre que um evento acontece,
seja o <code>push</code> para uma branch, ou algum outro evento do Github.</p>
<p>A grande maioria das ferramentas de CI permite fazer esses tipos de
controles/processos, mas o interessante do Github Actions √© que ele esta integrado
com o sistema de eventos (webhooks) e com a API do Github, ent√£o quando voc√™
quer usar funcionalidades do Github com os <a href=oi>commit status</a>,
<a href=oi>deployment status</a>, <a href=https://docs.github.com/en/github/collaborating-with-pull-requests/collaborating-on-repositories-with-code-quality-features/about-status-checks#checks>checks/annotations</a> o processo √© bem simples.</p>
<h2 id=como-temos-usado-o-github-actionsci-em-geral>Como temos usado o Github Actions/CI em geral</h2>
<p>Para a maioria dos projetos da <a href=https://coderockr.com>Coderockr</a> n√≥s sempre adicionamos algumas
ferramentas para CI, que s√£o executadas em todos os PRs e a maioria no <code>push</code>
para branchs &ldquo;principais&rdquo; (<code>main</code>, <code>develop</code>, <code>release</code>, etc).</p>
<p>Essas ferramentas s√£o fazem lint, analise est√°tica e testes unit√°rios, todas
elas s√£o &ldquo;script√°veis&rdquo; e configur√°veis, ent√£o podemos simplesmente com um shell
script simples podemos executar elas, capturar os arquivos com problema (as
vezes detalhando a linha espec√≠fica) e notificar o desenvolvedor sobre os
problemas e bloquear o merge/deploy baseado nelas.</p>
<h2 id=show-me-the-code>Show me the code</h2>
<p>Mas beleza, n√≥s temos as ferramentas, como integrar elas no Github Actions?
Para isso temos de criar um <code>workflow</code>, que √© o termo que o Github usa para
representar uma sequencia de etapas que √© executada em resposta a um evento no
reposit√≥rio ou API (<a href=#dispatch>voltamos nisso depois</a>).</p>
<dl>
<dt>üí° Todos os exemplos que vou mostrar podem ser vistos nesse reposit√≥rio:</dt>
<dd><a href=https://github.com/lucassabreu/github-actions-examples>lucassabreu/github-actions-examples</a></dd>
</dl>
<h3 id=workflow-simples>Workflow simples</h3>
<p>Para criar o <code>workflow</code> basta fazer o commit de um arquivo <code>yaml</code> dentro da pasta
<code>.github/workflows</code>, e automaticamente o Github ir√° utilizar ele assim que o
evento que voc√™ definiu acontecer com a branch que estiver (alguns eventos s√≥
v√£o funcionar se o <code>workflow</code> estiver na branch default).</p>
<p>Um exemplo simples que temos em alguns projetos √© esse:</p>
<div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#268bd2>name</span>: <span style=color:#2aa198>&#34;PHPUnit&#34;</span>
<span style=color:#268bd2>on</span>:
  <span style=color:#268bd2>pull_request</span>:
  <span style=color:#268bd2>push</span>:
    <span style=color:#268bd2>branches</span>: [main]

<span style=color:#268bd2>jobs</span>:
  <span style=color:#268bd2>php-tests</span>:
    <span style=color:#268bd2>runs-on</span>: ubuntu-latest
    <span style=color:#268bd2>timeout-minutes</span>: <span style=color:#2aa198>15</span>
    <span style=color:#268bd2>env</span>:
      <span style=color:#268bd2>COMPOSER_NO_INTERACTION</span>: <span style=color:#2aa198>1</span>

    <span style=color:#268bd2>steps</span>:
      - <span style=color:#268bd2>name</span>: Checkout code
        <span style=color:#268bd2>uses</span>: actions/checkout@v2

      - <span style=color:#268bd2>name</span>: Setup PHP
        <span style=color:#268bd2>uses</span>: shivammathur/setup-php@v2
        <span style=color:#268bd2>with</span>:
          <span style=color:#268bd2>php-version</span>: <span style=color:#2aa198>8.0</span>
          <span style=color:#268bd2>tools</span>: composer:v2

      - <span style=color:#268bd2>name</span>: Install dependencies
        <span style=color:#268bd2>run</span>: composer install --prefer-dist

      - <span style=color:#268bd2>name</span>: Execute Unit Tests
        <span style=color:#268bd2>run</span>: php vendor/bin/phpunit
</code></pre></div><p class=code-legend>.github/workflows/phpunit.yaml</p>
<p>Esse √© o tipo mais simples de <code>workflow</code> que pode ser feito no Github Actions,
apenas executa a cada push para a <code>main</code> e em todos os <code>pull requests</code>, e a
√∫nica sa√≠da gerada √© o &ldquo;commit status&rdquo;.</p>
<p><figure class=big>
<img class="lazyload blur-up" data-src=phpunit-basic-checks.png alt="commit status">
<figcaption><p>commit status gerados pelo workflow</p></figcaption>
</figure>
</p>
<p>Mas com isso j√° poss√≠vel bloquear <code>pull requests</code> que n√£o atendem a qualidade
esperada, ou que quebrem algo no caso do PHPUnit; para todos os
desenvolvedores do projeto o acesso a porqu√™ o commit n√£o passou esta a um
click.</p>
<p><figure class=big>
<img class="lazyload blur-up" data-src=./github-actions-check-details.png alt="check details">
<figcaption><p>logs do phpunit no github actions</p></figcaption>
</figure>
</p>
<h4 id=lintsanalise-est√°tica-com-annotations>Lints/Analise Est√°tica com annotations</h4>
<p>Mas esse √© s√≥ o b√°sico podemos fazer algumas coisas mais avan√ßadas com o Github
Actions e a integra√ß√£o &ldquo;auto-m√°gica&rdquo; com a API do Github.</p>
<p>Uma integra√ß√£o que hoje precisava de um setup grande para fazer, mas que era
muito boa para auxiliar no revis√£o autom√°tica s√£o os <a href=https://docs.github.com/en/github/collaborating-with-pull-requests/collaborating-on-repositories-with-code-quality-features/about-status-checks#checks>annotations</a>.</p>
<p><figure class=big>
<img class="lazyload blur-up" data-src=./phpstan-github-annotation.png alt="github annotations">
<figcaption><p>exemplo de annotations</p></figcaption>
</figure>
</p>
<hr>
<h1 id=heading></h1>
<h2 id=o-que-√©-o-github-actions>o que √© o github actions</h2>
<h2 id=no-que-temos-usado-o-github-actionsci>no que temos usado o github actions/ci</h2>
<h2 id=exemplos-para-pull-requestpush>exemplos para pull request/push</h2>
<h3 id=shbash-annotations-usando-output-format>sh/bash, annotations usando output format</h3>
<h3 id=usar-typescript-com-actions-kit>usar typescript com actions kit</h3>
<h3 id=usar-imagens-do-dockerdockerfile-action>usar imagens do docker/dockerfile action</h3>
<h2 id=eventos-interessantes>eventos interessantes</h2>
<h3 id=cron-wakatime-profile>cron: wakatime profile</h3>
<h3 id=issue-comment>issue comment</h3>
<h3 id=workflow_dispatch-gh-workflow-run>workflow_dispatch: gh workflow run</h3>
<h2 id=usar-os-runners-em-infra-pr√≥pria>usar os runners em infra pr√≥pria</h2>
</div><section class=share>
<p>
Share this post at
<a href="https://twitter.com/share?text=Github%20Actions&nbsp;-&nbsp;Lucas%20dos%20Santos%20Abreu&url=%2fpost%2fgithub-actions%2f" onclick="return window.open(this.href,'twitter-share','width=550,height=235'),!1">
Twitter
</a>
<a href="https://www.facebook.com/sharer/sharer.php?u=%2fpost%2fgithub-actions%2f" onclick="return window.open(this.href,'facebook-share','width=580,height=296'),!1">
Facebook
</a>
<a href="http://pinterest.com/pin/create/button/?url=%2fpost%2fgithub-actions%2f&description=Github%20Actions" onclick="return window.open(this.href,'pinterest-share','width=580,height=296'),!1">
Pinterest
</a>
</p>
</section>
<footer>
<section role=comment>
<p>
<div id=disqus_thread></div>
<script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//lucas-dos-santos-abreu.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script>
<noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript>
<a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a>
</p>
</section>
<section>
<p>
Published
by <span itemprop=author></span>
<time datetime=2021-09-12T00:00:00+00:00>
12 Sep, 2021
</time>
and tagged
<a href=/tags/github>Github</a>
<a href=/tags/github-actions>Github Actions</a>
<a href=/tags/continuous-integration>Continuous Integration</a>
using <span itemprop=wordCount>600</span> words.
</p>
</section>
</footer>
</article>
</main>
<aside>
<header>Related Content</header>
<ul>
<li>
<a href=/post/ambientes-por-branch-com-openshift-next-gen-usando-github/>Ambientes por Branch com OpenShift Next Gen usando¬†GitHub</a> &ndash;
<time>9 minute read</time>
</li>
<li>
<a href=/post/ambientes-por-branch-com-openshift-next-gen/>Ambientes por Branch com OpenShift Next¬†Gen</a> &ndash;
<time>9 minute read</time>
</li>
<li>
<a href=/post/simplificando-setup-projetos-github/>Simplificando o Setup de Projetos no GitHub</a> &ndash;
<time>2 minute read</time>
</li>
</ul>
</aside>
<footer>
<p>
&copy;
2021 ¬∑
This page was generated using <a target=_blank rel=noopener href=https://github.com/colorchestra/smol>smol<a> for <a target=_blank rel=noopener href=https://gohugo.io/>Hugo</a>.
</p>
</footer>
</body>
</html>